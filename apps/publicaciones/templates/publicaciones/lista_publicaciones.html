{% extends 'base.html' %}

{% block contenido %}

    {# T√≠tulo din√°mico: Usa el nombre de la categor√≠a si estamos filtrando, sino usa "√öltimas Publicaciones" #}
    <h2>{% if categoria_actual %}Noticias de {{ categoria_actual.nombre }}{% else %}√öltimas Publicaciones{% endif %}</h2>
    
    {# ----------------------------------------------------------- #}
    {# üö® LEYENDA DE GU√çA PARA VISITANTES AN√ìNIMOS (CORRECCI√ìN A√ëADIDA) üö® #}
    {% if not user.is_authenticated %}
    <div style="background-color: #f0f8ff; border: 1px solid #cceeff; padding: 10px; margin-bottom: 20px; border-radius: 5px; color: #333;">
        <p style="margin: 0;">
            üëã **¬°Bienvenido Visitante!** Para **leer el art√≠culo completo** y poder **dejar un comentario**, haz **CLIC sobre el t√≠tulo** de la publicaci√≥n que te interese.
        </p>
    </div>
    {% endif %}
    {# ----------------------------------------------------------- #}

    {# üö® INICIO DE LA L√ìGICA DE CATEGOR√çAS üö® #}
    {# CORRECCI√ìN: El men√∫ se muestra siempre que la lista 'categorias' no est√© vac√≠a, eliminando la condici√≥n de GET #}
    {% if categorias %}
        <h3>Selecciona una Categor√≠a:</h3>
        <ul style="list-style: none; padding: 0;">
            {% for categoria in categorias %}
                <li style="display: inline; margin-right: 15px;">
                    {# El enlace que filtra por categor√≠a #}
                    <a href="{% url 'publicaciones:por_categoria' slug_categoria=categoria.slug %}">
                        [ {{ categoria.nombre }} ]
                    </a>
                </li>
            {% empty %}
                 <p>No hay categor√≠as disponibles. (Revisa si creaste categor√≠as en /admin/)</p>
            {% endfor %}
        </ul>
        <hr>
        
        {# Opci√≥n para volver a la lista completa si estamos en una vista filtrada #}
        {% if categoria_actual %}
            <p><a href="{% url 'publicaciones:lista' %}">Mostrar todas las publicaciones</a></p>
            <hr>
        {% endif %}
    {% endif %}

    {# üö® FIN DE LA L√ìGICA DE CATEGOR√çAS üö® #}

    {# Lista de Publicaciones #}
    {% for publicacion in object_list %}
    <article style="border-bottom: 1px dashed #ccc; padding-bottom: 15px; margin-bottom: 15px;">
        <h3>
            {# Aseg√∫rate de que el t√≠tulo es un enlace para ir al detalle #}
            <a href="{% url 'publicaciones:detalle' slug=publicacion.slug pk=publicacion.pk %}">
                {{ publicacion.titulo }}
            </a>
        </h3>
        <p>Categor√≠a: **{{ publicacion.categoria.nombre }}** | Autor: **{{ publicacion.autor.username }}**</p>
        <p>{{ publicacion.contenido|truncatewords:20 }}</p> 
        <hr>
    </article>
    {% empty %}
        <p>No hay publicaciones disponibles en esta secci√≥n {% if categoria_actual %}para la categor√≠a "{{ categoria_actual.nombre }}"{% endif %}.</p>
    {% endfor %}

{% endblock contenido %}